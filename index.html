<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Avatar Preview</title>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <style>
    html,body{height:100%;margin:0;background:#111;color:#eee;font-family:system-ui,Arial;}
    #wrap{height:100%;display:flex;flex-direction:column}
    #toolbar{padding:8px;display:flex;gap:8px;align-items:center;background:#1b1b1b;border-bottom:1px solid #333}
    model-viewer{flex:1;width:100%}
    select,button{background:#222;border:1px solid #444;color:#eee;padding:6px 8px;border-radius:6px}
  </style>
</head>
<body>
<div id="wrap">
  <div id="toolbar">
    <label>Animation:</label>
    <select id="animSelect"><option>—</option></select>
    <button id="playPause">Pause</button>
    <button id="reload">Reload (cache-bust)</button>
  </div>

  <!-- добавь ?v=число, чтобы принудительно обновлять модель -->
  <model-viewer id="mv"
    src="./avatar.glb?v=1"
    camera-controls
    autoplay
    exposure="1.0"
    shadow-intensity="1"
    environment-image="neutral">
  </model-viewer>
</div>

<script type="module">
  const mv = document.getElementById('mv');
  const sel = document.getElementById('animSelect');
  const btn = document.getElementById('playPause');
  const reloadBtn = document.getElementById('reload');

  // после загрузки модели заполняем список анимаций и включаем первую
  mv.addEventListener('load', () => {
    sel.innerHTML = '';
    const list = mv.availableAnimations || [];
    if (list.length === 0) {
      sel.innerHTML = '<option>Нет анимаций в .glb</option>';
      return;
    }
    for (const name of list) {
      const opt = document.createElement('option');
      opt.textContent = name;
      opt.value = name;
      sel.appendChild(opt);
    }
    mv.animationName = list[0]; // автозапуск первой
    mv.play();
  });

  sel.addEventListener('change', () => {
    if (!mv.availableAnimations?.length) return;
    mv.animationName = sel.value;
    mv.currentTime = 0;
    mv.play();
    btn.textContent = 'Pause';
  });

  btn.addEventListener('click', () => {
    if (mv.paused) { mv.play(); btn.textContent = 'Pause'; }
    else { mv.pause(); btn.textContent = 'Play'; }
  });

  reloadBtn.addEventListener('click', () => {
    const url = new URL(mv.getAttribute('src'), location.href);
    url.searchParams.set('v', Date.now().toString()); // cache-bust
    mv.setAttribute('src', url.pathname + url.search);
  });
</script>
</body>
</html>
